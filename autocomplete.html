<!DOCTYPE html> 
<html>
<head>
	<title>Medical Charts</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta charset = 'utf-8'>
	<link rel="stylesheet" href="http://code.jquery.com/mobile/1.3.2/jquery.mobile-1.3.2.min.css" />
	<link rel="stylesheet" type="text/css" href="css/main.css"/>
	<script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
	<script src="http://code.jquery.com/mobile/1.3.2/jquery.mobile-1.3.2.min.js"></script>
	<script src = 'js/lib.js'></script>
</head>

<body>
	<div data-role = "page" id = 'master'>

		<div data-role = 'header'>
			<h1>Medical Charts Autocomplete</h1>
			<a href = '#' data-icon = 'gear' class = 'ui-btn-right'>Options</a>
		</div>

		<div data-role = 'content'>
			<!-- <a href = '#swipePanel'>Click me to open the panel!</a> -->
			<h3>Please enter your procedure</h3>
			<ul id = 'autocomplete' data-role = 'listview' data-inset = 'true' data-filter = 'true' data-filter-placeholder = 'Find a procedure...'></ul>
			<script type="text/javascript">
			//script for dynamically loading listviews that match
			var $ul;
				$('#autocomplete').on('listviewbeforefilter', function(e, data){
					$ul = $(this);
					$input = $(data.input);
					var value = $input.val();
					html = '';
					var $json;

					$ul.html("");
					if (value && value.length > 2) {
						$ul.html("<li><div class = 'ui-loader'><span class = 'ui-icon ui-icon-loading' href = '#sub-detail'></span></div></li>");
						$ul.listview('refresh');
						$.ajax({
							url: 'info.json',
							dataType: 'jsonp',
							crossDomain: true,
							jsonpCallback: 'jsonCallback',
							contentType: 'application/json',
							data: {
								q: $input.val()
							},
							success: function(json){
								//console.dir(json.info);
								$json = json;
								generatejson(json);
							}
						}) // end of ajax
						 //end of if
/*					.then(function(response){
						$.each(response.info[0], function(i, val){
							html += "<li><a href = '#sub-detail'" + val + "</a></li>";
							//console.log($json.info[i]);
						});

						$ul.html(html);
						$ul.listview('refresh');
						$ul.trigger('updatelayout');
						});*/
					}
				});


				function generatejson(data)
				{
					//console.log('generatejson');
					//console.log(data.info);
/*					$.each(data, function(k, val){
						html += "<li><a href = '#sub-detail'>" + val[0].DESCRIPTION + "</a></li>";
						//console.log(d);
						$ul.html(html);
						$ul.listview('refresh');
						$ul.trigger('updatelayout');
					});*/
					
					for (var i = 0; i < data.info.length; i++) {
						//console.log(data.info[i].DESCRIPTION);
						html += "<li><a href = '#sub-detail'>" + data.info[i].DESCRIPTION + "</a></li>";
						//update linked lists
						$ul.html(html);
						$ul.listview('refresh');
						$ul.trigger('updatelayout');
					};
				}
			</script>
			<a href = '#detail' data-role = 'button'>page failure Test button</a>
		</div>

		<div data-role = 'footer' data-position = 'fixed'>
			<div data-role = 'navbar'>
				<ul>
					<li><a href = '#swipePanel'>Info</a></li>
					<li><a href = '#'>Master</a></li>
					<li><a href = '#'>Calculator</a></li>
				</ul>
			</div>
		</div>

		<!-- panels **this must be placed as a sibiling of the page element** -->
		<div data-role="panel" id="swipePanel" data-dismissible = 'true'>
		    <!-- panel content goes here -->
		    <div data-role = 'content'>
		    	<h4>I'm a panel!</h4>
		    </div>
		</div><!-- /panel -->
	</div><!-- /master -->

	<!-- sub page for extended information -->
	<div data-role = "page" id = 'detail'>
		<div data-role = 'header'>
			<h1>Medical Chart Sub-Info</h1>
			<a href = '#' data-icon = 'gear' class = 'ui-btn-right'>Options</a>
			<a href = '#master' data-icon = '' class = 'ui-btn-left'>Back</a>
		</div><!-- /header -->

		<div data-role = 'content'>
			<ul data-role = 'listview' data-filter = 'true' data-filter-placeholder = 'Search...' data-inset = 'true' data-filter-reveal = 'false' id = 'nodeList'>
				<li><a href = '#sub-detail'>Node</a></li>
				<li><a href = '#sub-detail'>Node</a></li>
				<li><a href = '#sub-detail'>Node</a></li>
				<li><a href = '#sub-detail'>Node</a></li>
				<li><a href = '#sub-detail'>Node</a></li>
			</ul>
		</div><!-- /content -->


		<div data-role = 'footer' data-id = 'foo1' data-position = 'fixed'>
			<div data-role = 'navbar'>
				<ul>
					<li><a href = '#swipePanel'>Info</a></li>
					<li><a href = '#'>Master</a></li>
					<li><a href = '#'>Calculator</a></li>
				</ul>
			</div>
		</div>


		<div data-role="panel" id="swipePanel" data-dismissible = 'true'>
		    <!-- panel content goes here -->
		    <div data-role = 'content'>
		    	<h1>Current Region</h1>
		    	<h2>More Procedures</h2>
	    			<ul data-role = 'listview' data-inset = 'false'>
	    				<li data-role = 'list-divider'>Surgery</li>
	    				<li><a href="#">Scalpel</a></li>
	    				<li><a href="#">Suture</a></li>
	    				<li><a href="#">Surgical Tubing</a></li>
			    		<li data-role = 'list-divider'>X-Ray</li>
						<li><a href="#">CAT Scan</a></li>
						<li><a href="#">Lab Test</a></li>
					</ul>
			</div>
		</div><!-- /panel -->
	</div><!-- /detail -->



	<div data-role = 'page' id ='sub-detail'>
		<div data-role = 'header'>
			<h3>Procedure Title</h3>
			<a href = '#' data-icon = 'gear' class = 'ui-btn-right'>Options</a>
		</div>

		<div data-role = 'content'>
			<h1>Name of Procedure</h1>
			<h5>APC Group Title</h5>
			<p>Description 2</p>
			<h3>Payment/Cost</h3>
			<form>
				<div data-role = 'fieldcontain'>
					<label for = 'flip-calc'>Add to Calculator:</label>
					<select name = 'flip-calc' id = 'calcAdd' data-role = 'slider' data-track-theme = 'a' data-theme = 'a' data-mini = 'true'>
						<option value = 'off'></option>
						<option value = 'on'></option>
					</select> 
				</div>
			</form>
		</div>

		<!-- panels **this must be placed as a sibiling of the page element** -->
		<div data-role="panel" id="swipePanel" data-dismissible = 'true'>
		    <!-- panel content goes here -->
		    <div data-role = 'content'>
		    	<h1>Current Sub-Region</h1>
		    	<h2>More Procedures</h2>
	    			<ul data-role = 'listview' data-inset = 'true'>
	    				<li data-role = 'list-divider'>Surgery</li>
	    				<li><a href="#">Scalpel</a></li>
	    				<li><a href="#">Suture</a></li>
	    				<li><a href="#">Surgical Tubing</a></li>
			    		<li data-role = 'list-divider'>X-Ray</li>
						<li><a href="#">CAT Scan</a></li>
						<li><a href="#">Lab Test</a></li>
					</ul>
		    </div><!-- /content -->
		</div><!-- /panel -->

		<div data-role = 'footer' data-id = 'foo1' data-position = 'fixed'>
			<div data-role = 'navbar'>
				<ul>
					<li><a href = '#swipePanel'>Info</a></li>
					<li><a href = '#'>Master</a></li>
					<li><a href = '#'>Calculator</a></li>
				</ul>
			</div>
		</div><!-- /footer -->
	</div><!-- /sub-detail -->
<script type="text/javascript">
	var $nodes = $('#nodeList').find('li').find('a')[0].innerHTML = 'Changed';
</script>



</body>
</html>